<html>
<head>
    <title>idk</title>
    <style>
    /* TS: app.component.css */
    .overlay {
      fill: none;
      pointer-events: all;
    }
    .pa {
        pointer-events: all;
    }
    .pn {
        pointer-events: none;
    }
    path.hover {
        stroke: white;
        stroke-width: 5px;
        opacity:0.8;
    }
    </style>
</head>
<body>
    <h1>menu</h1>
    <h2 id="edit">
        <input type="text" placeholder="id" class="id"/>
        <input type="text" placeholder="name" class="name"/>
        <input type="submit"/>
    </h2>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

function tileedit(d) {
    document.querySelector('#edit input.id').value = d['id'];
    document.querySelector('#edit input.name').value = d['n'];
}

/* TS: map.component.ts:ngOnInit */
var width = 1500;
var height = 700;
var defaulttransform = {
    'translate': [-3000,-400],
    'scale': 1.3
};
var defaulttransformstr = 'translate(1500,-400) scale(-0.05, 0.05)';

var svg = d3.select('body').append('svg')
    .attr('width', width + 'px')
    .attr('height', height + 'px')
    .style('border', '5px solid red')

    // Use switching for now :(
    .on('contextmenu', function(d) {
        d3.event.preventDefault();
        // Switch 
        let e = document.querySelector('#dragger');
        let paths = d3.selectAll('path');
        if (e.style['pointer-events'] == 'all') {
            e.style['pointer-events'] = 'none';
            paths.attr('class', 'pa');
        } else {
            e.style['pointer-events'] = 'all';
            paths.attr('class', 'pn');
        }
    });

var container = svg.append('g');

var zoom = d3.zoom()
    //.scaleExtent([.001, .20])
    .on("zoom", zoomed)
    .on('start', zoomStart)
    .on('end', zoomEnd);

var rect = container.append("rect")
    .attr('id', 'dragger')
    .attr("class", "overlay")
    .attr("width", width)
    .attr("height", height)
    .style('stroke', 'yellow')
    .style('stroke-width', '1px')
    .style('pointer-events', 'all')
    .call(zoom);

var paths = svg.append('g').attr('id', 'paths');

const url = '/output/eu4map.json';
/* TS */// const url = '/assets/eu4map.json';

let self = this;
d3.json(url).get(function(error, data) {
    if (error) throw error;
    
    /* TS */// self.data = data;

    // Global
    paths.selectAll('g')
        .data(data).enter()
        
        .append('g')
        .attr('transform', 'translate(0.000000,2048.000000) scale(0.100000,-0.100000)')
        .append('path')

        .attr('id', (x) => 'province_' + x['id'])
        .attr('d', (x) => x['d'])
        .attr('style', (x) => 'fill: ' + x['hex'])
        .attr('class', 'pn')

        .on('mouseover', function(d) {
            d3.select(this).classed('hover', true);
        })
        .on('mouseout', function(d) {
            d3.select(this).classed('hover', false);
        })
        .on('click', function(d) {
            /* TS: *///self.clickDetail(d);
            tileedit(d);
        });

});
/* TS: end map.component.ts:ngOnInit */

/* TS: map.component.ts:zoomed */
function zoomed() {
    var t = d3.event.transform;
    //console.log(t);
    d3.select('#paths').attr('transform', "translate(" + t.x + "," + t.y + ") scale(" + t.k + "," + t.k + ")");
}

/* TS: map.component.ts:zoomStart */
function zoomStart() {
    console.log('zoom start')
}
/* TS: map.component.ts:zoomEnd */
function zoomEnd() {
    console.log('zoom end')
}

</script>
    </body>
    </html>